import{r,j as e,a as I,f as y,h as N,B as D}from"./index--uR3bosk.js";import{w as F}from"./loader-C4fNgBr5.js";import{u as R}from"./useTeamAction-BFYuUCef.js";import{a as S}from"./UserSelect-C6Zfnbmt.js";import{S as A}from"./SelectAsyncScroll-CqaChjMP.js";import{d as E}from"./common.utils-DPZ9yX3U.js";import{u as T}from"./useProjects-D3Wv5ymp.js";import{i as M}from"./validate.utils-ciPUpZAo.js";import{F as m,R as U,C as l}from"./index-BgZba38B.js";import{I as h}from"./index-0qdCREwA.js";import{S as B}from"./index-D5u-G5-S.js";import{h as L}from"./error.utils-BlwQgnKf.js";import{w as k}from"./auth.store-DCyo43Do.js";import{P as w}from"./Permission-BrgRu2qR.js";import{D as H,a as O,b as V}from"./DefaultContent-rY5y8PUg.js";import{D as q}from"./DefaultBreadcrumb-DHRDwWi8.js";import{e as C}from"./hasPermission-A1V7tTeH.js";import{F as G}from"./save-outline-BtesEFZG.js";import"./useUsers-DFLz3FjB.js";import"./index-Cw5KyAVY.js";import"./index-f1v-kFPc.js";import"./EllipsisOutlined-BTocrDpt.js";import"./dropdown-Dl8K4053.js";import"./index-c0GfCdz7.js";import"./collapse-BbEVqHco.js";import"./Input-CZqVGBfN.js";import"./useVariants-BuS53gwb.js";import"./useIcons-BCjpvc7O.js";import"./DownOutlined-DmCfGseC.js";import"./useBreakpoint-CJq1a_UD.js";const $=i=>{const{className:n,value:t,...a}=i,{projectPaginated:s,loading:g,request:p,updateRequest:c,fetchProjects:b}=T(),[P,j]=r.useState([]);r.useEffect(()=>{M(t)||b(Array.isArray(t)?t:[t]).then(o=>{j(o.map(d=>({label:d.name,value:d.id})))})},[]),r.useEffect(()=>{j(o=>{const d=s.data.map(f=>({label:f.name,value:f.id}));return s.currentPage===1?d:Array.from(new Map([...o??[],...d].map(f=>[f.value,f])).values())})},[s.data]);const u=r.useCallback(E(o=>{c(d=>({...d,pageNumber:1,searchConditions:[{column:"name",operator:"Contains",values:[o]}]}))},300),[p]),v=r.useCallback(()=>{s.hasNextPage&&c(o=>({...o,pageNumber:o.pageNumber+1}))},[p,s.hasNextPage]),x=()=>{c(o=>({...o,pageNumber:1}))};return e.jsx(A,{value:t,className:n,options:P,loading:g,onSearch:u,scrollInfiniteCb:v,firstOpenDropdown:x,...a})},z=r.memo($),J=r.forwardRef((i,n)=>{const{className:t,record:a,setLoading:s,...g}=i,p=I(),{loading:c,create:b,update:P,formDefault:j}=R();r.useEffect(()=>{s&&s(c)},[c,s]);const[u]=m.useForm(),[v]=r.useState(j(a));return r.useImperativeHandle(n,()=>({handelUpsert(){u.validateFields().then(async()=>{const x=u.getFieldsValue();a?await P(a.id,x,()=>p("/teams")):await b(x,()=>p("/teams"))})}})),e.jsxs("div",{...g,className:`form-container ${t}`,children:[e.jsx(m,{layout:"vertical",form:u,initialValues:v,validateTrigger:"onSubmit",children:e.jsxs(U,{wrap:!0,gutter:{sm:8,md:16},children:[e.jsx(l,{xs:24,lg:12,children:e.jsx(m.Item,{label:"Team name",name:"name",rules:[{required:!0}],children:e.jsx(h,{placeholder:"name"})})}),e.jsx(l,{span:24}),e.jsx(l,{xs:24,lg:12,children:e.jsx(m.Item,{label:"Description",name:"description",children:e.jsx(h,{placeholder:"description"})})}),e.jsx(l,{xs:24,lg:12,children:e.jsx(m.Item,{label:"Completed Projects",name:"completedProjects",children:e.jsx(h,{type:"number",placeholder:"completedProjects"})})}),e.jsx(l,{xs:24,lg:12,children:e.jsx(m.Item,{label:"Active Projects",name:"activeProjects",children:e.jsx(h,{type:"number",placeholder:"activeProjects"})})}),e.jsx(l,{xs:24,lg:12,children:e.jsx(m.Item,{label:"Manager",name:"managerId",children:e.jsx(S,{})})}),e.jsx(l,{xs:24,lg:12,children:e.jsx(m.Item,{label:"Members",name:"memberIds",children:e.jsx(S,{mode:"multiple"})})}),e.jsx(l,{xs:24,lg:12,children:e.jsx(m.Item,{label:"Projects",name:"projectIds",children:e.jsx(z,{mode:"multiple"})})})]})}),c&&e.jsx("div",{className:"loading-container",children:e.jsx(B,{})})]})}),we=F(async({params:i},{permissions:n})=>{const{id:t}=i;if(!t)return C(n,w.PermissionsTeamsCreate),null;C(n,w.PermissionsTeamsEdit);const a=await k(()=>L.teamGetById({id:+t}));if(!a)throw y("/teams");return a});function Ce(){const i=N(),[n,t]=r.useState(!1),a=r.useRef(null),s=()=>{a.current&&a.current.handelUpsert()};return e.jsxs(H,{children:[e.jsx(O,{title:i?"Update team":"Create team",children:e.jsx(D,{type:"primary",icon:e.jsx(G,{width:16,height:16}),onClick:s,loading:n,children:"Save"})}),e.jsx(q,{items:[{title:"Home",path:"/"},{title:"Teams Manager",path:"/teams"},{title:i?"Update team":"Create team"}]}),e.jsx(V,{children:e.jsx(J,{ref:a,setLoading:t,record:i})})]})}export{Ce as Component,we as loader};
