const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TimesheetAdjustmentRequestModel-B7DmFu8v.js","assets/index--uR3bosk.js","assets/index-BPvfZKEw.css","assets/auth.store-DCyo43Do.js","assets/error.utils-BlwQgnKf.js","assets/DatePicker-C7I8Jg0m.js","assets/typeof-C5VrKZhV.js","assets/dropdown-Dl8K4053.js","assets/index-c0GfCdz7.js","assets/EllipsisOutlined-BTocrDpt.js","assets/index-f1v-kFPc.js","assets/collapse-BbEVqHco.js","assets/Input-CZqVGBfN.js","assets/useVariants-BuS53gwb.js","assets/useIcons-BCjpvc7O.js","assets/DownOutlined-DmCfGseC.js","assets/index-0qdCREwA.js","assets/request.util-VCGDjS3F.js","assets/TimePicker.module-D3qUlonp.js","assets/TimePicker-BwnGrq2V.css","assets/date.utils-CRd9Tq6_.js","assets/startOfDay-DVNVffkj.js","assets/en-US-BRWW7OjM.js","assets/buildMatchPatternFn-DF4FdbSS.js","assets/validate.utils-ciPUpZAo.js","assets/timesheet.util-DfkHrtme.js","assets/addMonths-CDK6CqD6.js","assets/gapSize-U1swVQyS.js","assets/isBefore-CMcmE5sE.js","assets/index-BgZba38B.js","assets/useBreakpoint-CJq1a_UD.js","assets/index-BgAJHb6z.js","assets/timesheet.store-D6THQ--x.js","assets/calendar-check-YvWhLMyH.js","assets/DefaultContent-rY5y8PUg.js","assets/common.utils-DPZ9yX3U.js","assets/DefaultContent-Cnu4jn1A.css","assets/index-BCYX8c6P.js","assets/index-CULCKU4c.js","assets/index-CWAu2eCQ.js","assets/loader-C4fNgBr5.js","assets/MainTable-GzCEjfuZ.js","assets/index-Cw5KyAVY.js","assets/index-tL5HCDFB.js","assets/index-BsljEl-V.js","assets/index-ndTAV7xn.js","assets/index-D5u-G5-S.js","assets/MainTable-bN2nDh4l.css","assets/chevron-back-yLp5EtMO.js","assets/chevron-forward-BP65w4GZ.js","assets/differenceInDays-BOrY2M2f.js","assets/endOfMonth-BI9bRzhF.js","assets/DefaultBreadcrumb-DHRDwWi8.js","assets/DefaultBreadcrumb-BO2nQZti.css","assets/LeaveRequestModel-DE5Uy5ne.js","assets/useLeaveRequestAction-B9BHWY00.js"])))=>i.map(i=>d[i]);
import{r as u,i as C,j as r,S as N,B as y,e as Y,k as $,l as W,_}from"./index--uR3bosk.js";import{n as w,g as b,c as R,f as T,a as V}from"./date.utils-CRd9Tq6_.js";import{u as F,F as U}from"./timesheet.store-D6THQ--x.js";import{d as G,a as j,b as K,c as p}from"./timesheet.util-DfkHrtme.js";import{u as I}from"./auth.store-DCyo43Do.js";import{t as J,g as A,R as g,r as v,a as D}from"./error.utils-BlwQgnKf.js";import{i as Q,g as X,a as Z,b as L,B as ee,F as te}from"./calendar-check-YvWhLMyH.js";import{a as se,D as ne,b as re}from"./DefaultContent-rY5y8PUg.js";import{T as E}from"./index-BCYX8c6P.js";import{P as ae}from"./index-CULCKU4c.js";import{w as ie}from"./loader-C4fNgBr5.js";import{M as oe,F as ce}from"./MainTable-GzCEjfuZ.js";import{S as ue}from"./index-BsljEl-V.js";import{i as le}from"./isBefore-CMcmE5sE.js";import{D as de}from"./DatePicker-C7I8Jg0m.js";import{S as me}from"./index-D5u-G5-S.js";import{F as he}from"./chevron-back-yLp5EtMO.js";import{F as fe}from"./chevron-forward-BP65w4GZ.js";import{F as q,a as S}from"./addMonths-CDK6CqD6.js";import{d as ge}from"./differenceInDays-BOrY2M2f.js";import{m as xe,a as ye,t as P}from"./startOfDay-DVNVffkj.js";import{e as Te}from"./endOfMonth-BI9bRzhF.js";import{D as we}from"./DefaultBreadcrumb-DHRDwWi8.js";function je(t,e,s){const[a,n]=w(s==null?void 0:s.in,t,e),o=a.getFullYear()-n.getFullYear(),c=a.getMonth()-n.getMonth();return o*12+c}function Re(t,e,s){const[a,n]=w(s==null?void 0:s.in,t,e);return a.getFullYear()-n.getFullYear()}function De(t,e,s){const[a,n]=w(s==null?void 0:s.in,t,e),o=(+a-+n)/xe;return b(s==null?void 0:s.roundingMethod)(o)}function Ce(t,e,s){const a=G(t,e)/ye;return b(s==null?void 0:s.roundingMethod)(a)}function Me(t,e){const s=P(t,e==null?void 0:e.in);return s.setHours(23,59,59,999),s}function ke(t,e){const s=P(t,e==null?void 0:e.in);return+Me(s,e)==+Te(s,e)}function pe(t,e,s){const[a,n,o]=w(s==null?void 0:s.in,t,t,e),c=R(n,o),i=Math.abs(je(n,o));if(i<1)return 0;n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-c*i);let d=R(n,o)===-c;ke(a)&&i===1&&R(a,o)===1&&(d=!1);const l=c*(i-+d);return l===0?0:l}function ve(t,e,s){const[a,n]=w(s==null?void 0:s.in,t,e),o=R(a,n),c=Math.abs(Re(a,n));a.setFullYear(1584),n.setFullYear(1584);const i=R(a,n)===-o,d=o*(c-+i);return d===0?0:d}function qe(t,e){const[s,a]=w(t,e.start,e.end);return{start:s,end:a}}function Se(t,e){const{start:s,end:a}=qe(e==null?void 0:e.in,t),n={},o=ve(a,s);o&&(n.years=o);const c=j(s,{years:n.years}),i=pe(a,c);i&&(n.months=i);const d=j(c,{months:n.months}),l=ge(a,d);l&&(n.days=l);const h=j(d,{days:n.days}),m=De(a,h);m&&(n.hours=m);const f=j(h,{hours:n.hours}),x=Ce(a,f);x&&(n.minutes=x);const B=j(f,{minutes:n.minutes}),k=K(a,B);return k&&(n.seconds=k),n}const _e="_headerContainer_1f15o_1",be={headerContainer:_e},Fe=()=>{const{startTime:t,endTime:e,timeDifference:s,isActive:a,reset:n}=F(),o=I(m=>{var f;return(f=m.user)==null?void 0:f.workTime}),c=u.useRef(null),[i,d]=u.useState("--:-- - --:--:--"),l=u.useCallback(()=>{if(!(!t||!o))if(a){const m=new Date(Date.now()-s),f=T(m),x=p(t,m,o);d(`${x.toFixed(2)} - ${f}`)}else{const m=p(t,e??t,o);d(`${m.toFixed(2)}`)}},[t,s,o,e,a]);u.useEffect(()=>(t&&(l(),!c.current&&a&&(c.current=setInterval(l,1e3))),()=>{c.current&&(clearInterval(c.current),c.current=null)}),[t,l]);const h=()=>{const m=new Date,f=new Date(m);f.setHours(24,0,0,0);const x=f.getTime()-m.getTime()+5e3;return setTimeout(()=>{n(),h()},x)};return{timeString:i,scheduleResetAtMidnight:h}},Ie=()=>{const[t,e]=u.useState(!1),[s,a]=u.useState([]),[n,o]=u.useState(new Date),c=Q(n,new Date),i=async l=>{e(!0);try{const h=await J.timesheetGetCurrentUserMonthlyTimesheets({month:Z(l)+1,year:X(l)});a(h)}catch(h){C().error({message:await A(h)})}finally{e(!1)}},d=u.useCallback(l=>{o(h=>{const m=l===void 0?h:typeof l=="function"?l(h):l;return i(m),m})},[]);return{timesheets:s,loading:t,selectedDate:n,isCurrentMonth:c,updateSelectedDate:d,getCurrentTimesheets:i}},O=u.createContext(null),Ae=({children:t})=>{const{timesheets:e,loading:s,selectedDate:a,updateSelectedDate:n,isCurrentMonth:o,getCurrentTimesheets:c}=Ie();return r.jsx(O.Provider,{value:{timesheets:e,loading:s,selectedDate:a,updateSelectedDate:n,isCurrentMonth:o,getCurrentTimesheets:c},children:t})},M=()=>{const t=u.useContext(O);if(!t)throw new Error("currentContext has to be used");return t},z=u.createContext(null),Le=({children:t})=>{const[e,s]=u.useState(!1),[a,n]=u.useState(),[o,c]=u.useState(g.LeaveRequest),i=(h,m=void 0)=>{c(h),s(!0),n(m)},d=()=>s(!1),l=u.useCallback(h=>e&&o===h,[e,o]);return r.jsx(z.Provider,{value:{isOpen:l,requestType:o,openRequest:i,closeRequest:d,date:a},children:t})},H=()=>{const t=u.useContext(z);if(!t)throw new Error("currentContext has to be used");return t},Ee=(t,e)=>r.jsx("svg",{viewBox:"0 0 512 512",width:"24px",height:"24px",ref:e,...t,children:r.jsx("path",{fill:"currentColor",d:"M133 440a35.37 35.37 0 0 1-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0 1 35.77.45l247.85 148.36a36 36 0 0 1 0 61l-247.89 148.4A35.5 35.5 0 0 1 133 440"})}),Pe=u.forwardRef(Ee),Oe=(t,e)=>r.jsx("svg",{viewBox:"0 0 512 512",width:"24px",height:"24px",ref:e,...t,children:r.jsx("path",{fill:"currentColor",d:"M208 432h-48a16 16 0 0 1-16-16V96a16 16 0 0 1 16-16h48a16 16 0 0 1 16 16v320a16 16 0 0 1-16 16m144 0h-48a16 16 0 0 1-16-16V96a16 16 0 0 1 16-16h48a16 16 0 0 1 16 16v320a16 16 0 0 1-16 16"})}),ze=u.forwardRef(Oe),He=()=>{const{timeString:t,scheduleResetAtMidnight:e}=Fe(),[s,a]=u.useState(!1),{startTime:n,isActive:o,checkIn:c,checkOut:i,fetchTodayTimesheet:d}=F(),{getCurrentTimesheets:l,isCurrentMonth:h}=M(),{openRequest:m}=H(),f=async x=>{await x(),h&&await l(new Date)};return u.useEffect(()=>{n||(async()=>(a(!0),await d(),a(!1)))();const x=e();return()=>clearTimeout(x)},[]),r.jsx(se,{title:"Timesheet",children:r.jsxs("div",{className:be.headerContainer,children:[n&&r.jsx(E,{color:"blue",children:T(n)}),r.jsx("div",{className:"action",children:s?r.jsx(N.Input,{active:!0}):r.jsxs(r.Fragment,{children:[r.jsx(y,{onClick:()=>m(g.TimesheetAdjustmentRequest),children:"Edit"}),r.jsx(y,{onClick:()=>m(g.LeaveRequest),children:"Leave"}),r.jsx(y,{icon:r.jsx(U,{width:20,style:{color:o?$.primary:Y.primary}}),style:{pointerEvents:"none"},children:t}),n?r.jsx(ae,{title:"Are you sure you want to checkout?",description:r.jsx("div",{style:{maxWidth:"400px"},children:"Ngay cả khi bạn không thực hiện checkout, hệ thống vẫn sẽ tự động ghi nhận thời gian kết thúc dựa trên lượt chấm công cuối cùng của bạn."}),okText:"Yes",cancelText:"No",placement:"bottomRight",onConfirm:()=>f(i),children:r.jsx(y,{danger:!0,disabled:!o,children:r.jsx(ze,{})})}):r.jsx(y,{onClick:()=>f(c),children:r.jsx(Pe,{})})]})})]})})},Be=[{title:"Date",dataIndex:"dateString",key:"dateString",width:"12%"},{title:"Start Time",dataIndex:"startTime",key:"startTime"},{title:"End Time",key:"endTime",dataIndex:"endTime",width:"16%"},{title:"Total Work",key:"workMinutes",dataIndex:"workMinutes"},{title:"Action",key:"action",width:"10rem",render:(t,e)=>r.jsx(Ne,{date:e.date,startTime:e.startTime})}],Ne=({date:t,startTime:e})=>{const{openRequest:s}=H();let a=!1;return(!L(t)&&le(t,Date.now())||e)&&(a=!0),a?r.jsxs(ue,{size:"small",children:[r.jsx(y,{size:"small",color:"primary",variant:"outlined",onClick:()=>s(g.TimesheetAdjustmentRequest,t),children:"Edit"}),r.jsx(y,{size:"small",color:"cyan",variant:"outlined",onClick:()=>s(g.LeaveRequest,t),children:"Leave"})]}):null},Ye=()=>{const[t,e]=u.useState(!1),s={[g.LeaveRequest]:async n=>{await v.leaveRequestCancelRequest({id:n})},[g.TimesheetAdjustmentRequest]:async n=>{await v.timesheetAdjustmentRequestCancelRequest({id:n})},[g.OvertimeRequest]:async()=>{},[g.WorkFromHomeRequest]:async()=>{}};return{loading:t,cancel:async(n,o)=>{e(!0);try{const c=s[o];await c(n),C().success({message:"Successfully completed"})}catch(c){C().error({message:await A(c)})}finally{e(!1)}}}},$e=[{title:"Date",render:(t,e)=>T(e.date,"dd/MM/yyyy"),key:"date"},{title:"Request Type",key:"requestType",render:(t,e)=>{const{requestType:s}=e,a={[g.LeaveRequest]:"green",[g.TimesheetAdjustmentRequest]:"orange",[g.OvertimeRequest]:"purple",[g.WorkFromHomeRequest]:"blue"};return r.jsx(E,{color:a[s],children:e.requestType})}},{title:"Time",key:"endTime",render:(t,e)=>`${T(e.breakStartDate)} - ${T(e.breakEndDate)}`},{title:"Reason",key:"reason",dataIndex:"reason"},{title:"Status",key:"status",render:(t,e)=>{const{status:s}=e,a={[D.Pending]:"default",[D.Approved]:"success",[D.Rejected]:"error"};return r.jsx(ee,{status:a[s],text:e.status})}},{title:"Action",key:"action",width:"10rem",render:(t,e)=>r.jsx(We,{request:e})}],We=({request:t})=>{const{loading:e,cancel:s}=Ye(),{getCurrentTimesheets:a,isCurrentMonth:n}=M();if(t.status!==D.Pending)return null;const o=async()=>{await s(t.id,t.requestType),n&&await a(new Date)};return r.jsx(me,{spinning:e,children:r.jsx("a",{onClick:o,children:"Cancel"})})},Ve=()=>{const{timesheets:t,loading:e,selectedDate:s,updateSelectedDate:a,isCurrentMonth:n}=M(),o=I(i=>{var d;return(d=i.user)==null?void 0:d.remainingLeaveMinutes});u.useEffect(()=>{a(new Date)},[]);const c=u.useMemo(()=>t.map(i=>({id:i.id,date:i.date,dateString:T(i.date,"dd/MM/yyyy"),startTime:i.startTime?T(i.startTime):void 0,endTime:i.endTime?T(i.endTime):void 0,workMinutes:i.workMinutes,requests:i.requests})),[t]);return r.jsxs(q,{vertical:!0,style:{height:"100%"},children:[r.jsxs(q,{gap:"small",justify:"space-between",align:"end",flex:"none",style:{marginBottom:"1rem"},children:[r.jsxs("div",{style:{marginRight:"auto"},children:["Remaining leave balance:"," ",o?V(Se({start:0,end:o*60*1e3}),{zero:!0}):"0"]}),r.jsx(y,{icon:r.jsx(he,{style:{width:20}}),onClick:()=>a(i=>S(i,-1))}),r.jsx(de,{picker:"month",value:s,onChange:i=>a(i),showNow:!0}),r.jsx(y,{icon:r.jsx(fe,{style:{width:20}}),onClick:()=>a(i=>S(i,1))}),r.jsx(y,{icon:r.jsx(te,{style:{width:20}}),style:{color:n?W.primary:"inherit"},onClick:()=>a(new Date)})]}),r.jsx("div",{style:{flexGrow:1,minHeight:0},children:r.jsx(oe,{className:"timesheet-table",columns:Be,dataSource:c,loading:e,pagination:!1,rowClassName:i=>L(i.date)?"weekend-row":"",expandable:{expandedRowRender:i=>(i.requests??[]).length>0?r.jsx(ce,{rowKey:"id",dataSource:i.requests??void 0,pagination:!1,columns:$e}):null,rowExpandable:i=>(i.requests??[]).length>0}})})]})},Ue=u.lazy(()=>_(()=>import("./TimesheetAdjustmentRequestModel-B7DmFu8v.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53]))),Ge=u.lazy(()=>_(()=>import("./LeaveRequestModel-DE5Uy5ne.js"),__vite__mapDeps([54,1,2,3,4,55,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53]))),Ke=ie();function Je(){return r.jsx(Ae,{children:r.jsx(Le,{children:r.jsxs(ne,{pageClassName:"h-screen",children:[r.jsx(He,{}),r.jsx(we,{items:[{title:"Home",path:"/"},{title:"Timesheets Manager"}],style:{paddingBottom:"1rem"}}),r.jsx(re,{children:r.jsx(Ve,{})}),r.jsxs(u.Suspense,{fallback:null,children:[r.jsx(Ge,{}),r.jsx(Ue,{})]})]})})})}const jt=Object.freeze(Object.defineProperty({__proto__:null,Component:Je,loader:Ke},Symbol.toStringTag,{value:"Module"}));export{jt as T,M as a,H as u};
