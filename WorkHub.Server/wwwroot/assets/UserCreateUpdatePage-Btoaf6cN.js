import{r as t,j as e,a as E,f as O,h as M,B as q}from"./index--uR3bosk.js";import{w as B}from"./loader-C4fNgBr5.js";import{u as W}from"./useUserAction-eJtgLnYp.js";import{N as _,U as H,c as L,u as Y}from"./error.utils-BlwQgnKf.js";import{D as G}from"./DatePicker-C7I8Jg0m.js";import{T as V}from"./TeamSelect-DW5BM7kK.js";import{a as $}from"./UserSelect-C6Zfnbmt.js";import{u as D,w as z}from"./auth.store-DCyo43Do.js";import{u as J}from"./useRoles-DtdAa_yA.js";import{S as U}from"./SelectAsyncScroll-CqaChjMP.js";import{d as A}from"./common.utils-DPZ9yX3U.js";import{i as F}from"./validate.utils-ciPUpZAo.js";import{u as K}from"./useWorkTimes-xPlE9kem.js";import{u as Q}from"./useBreakpoint-CJq1a_UD.js";import{u as X}from"./useTranslation-ViRP3SwV.js";import{F as r,R as Z,C as a}from"./index-BgZba38B.js";import{I as p}from"./index-0qdCREwA.js";import{S as N}from"./index-Cw5KyAVY.js";import{R as v}from"./index-ndTAV7xn.js";import{C as ee}from"./index-tL5HCDFB.js";import{S as se}from"./index-D5u-G5-S.js";import{P as R}from"./Permission-BrgRu2qR.js";import{D as re,a as ae,b as te}from"./DefaultContent-rY5y8PUg.js";import{D as le}from"./DefaultBreadcrumb-DHRDwWi8.js";import{e as k}from"./hasPermission-A1V7tTeH.js";import{F as oe}from"./save-outline-BtesEFZG.js";import"./typeof-C5VrKZhV.js";import"./dropdown-Dl8K4053.js";import"./index-c0GfCdz7.js";import"./EllipsisOutlined-BTocrDpt.js";import"./index-f1v-kFPc.js";import"./collapse-BbEVqHco.js";import"./Input-CZqVGBfN.js";import"./useVariants-BuS53gwb.js";import"./useIcons-BCjpvc7O.js";import"./DownOutlined-DmCfGseC.js";import"./useTeams-CPTViS0J.js";import"./useUsers-DFLz3FjB.js";function ne(){return Q()}const ie={useBreakpoint:ne},me="_colCustomResponsive_y2npj_3",I={colCustomResponsive:me},ce=u=>{const{className:x,value:l,...i}=u,{rolePaginated:o,loading:b,request:f,updateRequest:c,fetchRoles:P}=J(),[g,h]=t.useState([]);t.useEffect(()=>{F(l)||P(Array.isArray(l)?l:[l]).then(s=>{h(s.map(n=>({label:n.name,value:n.id})))})},[]),t.useEffect(()=>{h(s=>{const n=o.data.map(m=>({label:m.name,value:m.name}));return o.currentPage===1?n:Array.from(new Map([...s??[],...n].map(m=>[m.value,m])).values())})},[o.data]);const w=t.useCallback(A(s=>{c(n=>({...n,pageNumber:1,searchConditions:[{column:"name",operator:"Contains",values:[s]}]}))},300),[f]),C=t.useCallback(()=>{o.hasNextPage&&c(s=>({...s,pageNumber:s.pageNumber+1}))},[f,o.hasNextPage]),S=()=>{c(s=>({...s,pageNumber:1}))};return e.jsx(U,{value:l,className:x,options:g,loading:b,onSearch:w,scrollInfiniteCb:C,firstOpenDropdown:S,mode:"multiple",...i})},de=t.memo(ce),ue=u=>{const{className:x,value:l,...i}=u,{workTimePaginated:o,loading:b,request:f,updateRequest:c,fetchWorkTimes:P}=K(),[g,h]=t.useState([]);t.useEffect(()=>{F(l)||P(Array.isArray(l)?l:[l]).then(s=>{h(s.map(n=>({label:n.title,value:n.id})))})},[]),t.useEffect(()=>{h(s=>{const n=o.data.map(m=>({label:m.title,value:m.id}));return o.currentPage===1?n:Array.from(new Map([...s??[],...n].map(m=>[m.value,m])).values())})},[o.data]);const w=t.useCallback(A(s=>{c(n=>({...n,pageNumber:1,searchConditions:[{column:"title",operator:"Contains",values:[s]}]}))},300),[f]),C=t.useCallback(()=>{o.hasNextPage&&c(s=>({...s,pageNumber:s.pageNumber+1}))},[f,o.hasNextPage]),S=()=>{c(s=>({...s,pageNumber:1}))};return e.jsx(U,{value:l,className:x,options:g,loading:b,onSearch:w,scrollInfiniteCb:C,firstOpenDropdown:S,...i})},pe=t.memo(ue),{useBreakpoint:xe}=ie,he=t.forwardRef((u,x)=>{const{className:l,record:i,setLoading:o,...b}=u,f=xe(),c=D(d=>d.user),{t:P}=X(),g=E(),{loading:h,createUser:w,updateUser:C,formDefault:S}=W();t.useEffect(()=>{o&&o(h)},[h,o]);const[s]=r.useForm(),[n]=t.useState(S(i)),[m,T]=t.useState(!1);return t.useImperativeHandle(x,()=>({handelUpsert(){s.validateFields().then(async()=>{const d=s.getFieldsValue();i?await C(i.id,d,j=>{g("/users"),(c==null?void 0:c.id)===j.id&&D.getState().load()}):await w(d,()=>g("/users"))})}})),e.jsxs("div",{...b,className:`form-container ${l}`,children:[e.jsxs(r,{layout:f.lg?"horizontal":"vertical",form:s,initialValues:n,validateTrigger:"onSubmit",labelCol:{lg:{span:9},xl:{span:10},xxl:{span:8}},children:[e.jsx(r.Item,{hidden:!0,name:["userDetail","id"],children:e.jsx(p,{})}),e.jsxs(Z,{wrap:!0,gutter:{sm:8,md:16},children:[e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"FullName",name:"fullName",rules:[{max:36,required:!0}],children:e.jsx(p,{placeholder:"FullName"})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"Email",name:"email",rules:[{required:!0}],children:e.jsx(p,{placeholder:"email"})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"UserName",name:"userName",rules:[{required:!0}],children:e.jsx(p,{placeholder:"UserName"})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"BirthDate",name:["userDetail","birthDate"],children:e.jsx(G,{format:"YYYY-MM-DD",style:{width:"100%"}})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"Phone Number",name:"phoneNumber",children:e.jsx(p,{placeholder:"email"})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"Nationality",name:["userDetail","nationality"],rules:[{required:!0}],children:e.jsx(N,{options:Object.entries(_).map(([d,j])=>({value:j,label:P("nationality."+j.replace(/_/g,"-"))}))})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"Gender",name:["userDetail","gender"],children:e.jsxs(v.Group,{children:[e.jsx(v,{value:"1",children:" Male "}),e.jsx(v,{value:"0",children:" Female "})]})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"User Status",name:"userStatus",children:e.jsx(N,{options:Object.entries(H).map(([d,j])=>({value:j,label:d}))})})}),e.jsx(a,{span:24,children:e.jsx(r.Item,{label:"Permanent Address",name:["userDetail","permanentAddress"],className:I.colCustomResponsive,children:e.jsx(p,{placeholder:"Permanent Address"})})}),e.jsx(a,{span:24,children:e.jsx(r.Item,{label:"Contact Address",name:["userDetail","contactAddress"],className:I.colCustomResponsive,children:e.jsx(p,{placeholder:"Contact Address"})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"User Position",name:"userPosition",rules:[{required:!0}],children:e.jsx(N,{options:Object.entries(L).map(([d,j])=>({value:j,label:d}))})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"Team",name:"teamId",children:e.jsx(V,{})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"Supervisor",name:"supervisorId",children:e.jsx($,{withoutIds:c?[c.id]:[]})})}),e.jsx(a,{span:24,children:e.jsx(r.Item,{label:"Roles",name:"roleNames",className:I.colCustomResponsive,children:e.jsx(de,{})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"WorkTime",name:"workTimeId",children:e.jsx(pe,{})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"Leave Hours",name:"leaveHours",children:e.jsx(p,{})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"Years Of Work",name:["userDetail","yearsOfWork"],children:e.jsx(p,{})})}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"Change password",layout:"horizontal",children:e.jsx(ee,{checked:m,onChange:d=>T(d.target.checked)})})}),e.jsx(a,{span:24}),m&&e.jsxs(e.Fragment,{children:[e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}],children:e.jsx(p,{})})}),e.jsx(a,{span:24}),e.jsx(a,{xs:24,lg:12,xl:8,children:e.jsx(r.Item,{label:"Re Password",name:"rePassword",dependencies:["password"],rules:[{required:!0,message:"Please confirm your password!"},({getFieldValue:d})=>({validator(j,y){return!y||d("password")===y?Promise.resolve():Promise.reject(new Error("Passwords do not match!"))}})],children:e.jsx(p,{})})})]})]})]}),h&&e.jsx("div",{className:"loading-container",children:e.jsx(se,{})})]})}),es=B(async({params:u},{permissions:x})=>{const{id:l}=u;if(!l)return k(x,R.PermissionsUsersCreate),null;k(x,R.PermissionsUsersEdit);const i=await z(()=>Y.userGetById({id:l}));if(!i)throw O("/users");return i});function ss(){const u=M(),[x,l]=t.useState(!1),i=t.useRef(null),o=()=>{i.current&&i.current.handelUpsert()};return e.jsxs(re,{children:[e.jsx(ae,{title:u?"Update user":"Create user",children:e.jsx(q,{type:"primary",icon:e.jsx(oe,{width:16,height:16}),onClick:o,loading:x,children:"Save"})}),e.jsx(le,{items:[{title:"Home",path:"/"},{title:"Users Manager",path:"/users"},{title:u?"Update user":"Create user"}]}),e.jsx(te,{children:e.jsx(he,{ref:i,setLoading:l,record:u})})]})}export{ss as Component,es as loader};
