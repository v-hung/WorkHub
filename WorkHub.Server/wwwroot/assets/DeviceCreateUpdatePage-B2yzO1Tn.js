import{r as s,j as e,a as w,f as y,h as I,B as P}from"./index--uR3bosk.js";import{w as N}from"./loader-C4fNgBr5.js";import{D as F,k as R}from"./error.utils-BlwQgnKf.js";import{u as A}from"./useDeviceAction-BaCBKAKk.js";import{a as E}from"./UserSelect-C6Zfnbmt.js";import{S as U}from"./SelectAsyncScroll-CqaChjMP.js";import{d as L}from"./common.utils-DPZ9yX3U.js";import{u as k}from"./useDeviceCategories-BhEuV2A7.js";import{i as B}from"./validate.utils-ciPUpZAo.js";import{F as c,R as M,C as p}from"./index-BgZba38B.js";import{I as S}from"./index-0qdCREwA.js";import{S as O}from"./index-Cw5KyAVY.js";import{S as H}from"./index-D5u-G5-S.js";import{w as V}from"./auth.store-DCyo43Do.js";import{P as b}from"./Permission-BrgRu2qR.js";import{D as q,a as G,b as T}from"./DefaultContent-rY5y8PUg.js";import{D as $}from"./DefaultBreadcrumb-DHRDwWi8.js";import{e as C}from"./hasPermission-A1V7tTeH.js";import{F as z}from"./save-outline-BtesEFZG.js";import"./useUsers-DFLz3FjB.js";import"./collapse-BbEVqHco.js";import"./useBreakpoint-CJq1a_UD.js";import"./index-f1v-kFPc.js";import"./Input-CZqVGBfN.js";import"./useVariants-BuS53gwb.js";import"./EllipsisOutlined-BTocrDpt.js";import"./dropdown-Dl8K4053.js";import"./index-c0GfCdz7.js";import"./useIcons-BCjpvc7O.js";import"./DownOutlined-DmCfGseC.js";const J=o=>{const{className:n,value:t,...a}=o,{deviceCategoryPaginated:i,loading:v,request:u,updateRequest:l,fetchDeviceCategories:g}=k(),[j,x]=s.useState([]);s.useEffect(()=>{B(t)||g(Array.isArray(t)?t:[t]).then(r=>{x(r.map(m=>({label:m.name,value:m.id})))})},[]),s.useEffect(()=>{x(r=>{const m=i.data.map(h=>({label:h.name,value:h.id}));return i.currentPage===1?m:Array.from(new Map([...r??[],...m].map(h=>[h.value,h])).values())})},[i.data]);const f=s.useCallback(L(r=>{l(m=>({...m,pageNumber:1,searchConditions:[{column:"name",operator:"Contains",values:[r]}]}))},300),[u]),D=s.useCallback(()=>{i.hasNextPage&&l(r=>({...r,pageNumber:r.pageNumber+1}))},[u,i.hasNextPage]),d=()=>{l(r=>({...r,pageNumber:1}))};return e.jsx(U,{value:t,className:n,options:j,loading:v,onSearch:f,scrollInfiniteCb:D,firstOpenDropdown:d,...a})},K=s.memo(J),Q=s.forwardRef((o,n)=>{const{className:t,record:a,setLoading:i,...v}=o,u=w(),{loading:l,create:g,update:j,formDefault:x}=A();s.useEffect(()=>{i&&i(l)},[l,i]);const[f]=c.useForm(),[D]=s.useState(x(a));return s.useImperativeHandle(n,()=>({handelUpsert(){f.validateFields().then(async()=>{const d=f.getFieldsValue();a?await j(a.id,d,()=>u("/devices")):await g(d,()=>u("/devices"))})}})),e.jsxs("div",{...v,className:`form-container ${t}`,children:[e.jsx(c,{layout:"vertical",form:f,initialValues:D,validateTrigger:"onSubmit",children:e.jsxs(M,{wrap:!0,gutter:{sm:8,md:16},children:[e.jsx(p,{xs:24,lg:12,children:e.jsx(c.Item,{label:"Device name",name:"name",rules:[{required:!0}],children:e.jsx(S,{placeholder:"name"})})}),e.jsx(p,{xs:24,children:e.jsx(c.Item,{label:"Description",name:"description",children:e.jsx(S,{placeholder:"description"})})}),e.jsx(p,{xs:24,lg:12,children:e.jsx(c.Item,{label:"Location",name:"location",children:e.jsx(S,{placeholder:"location"})})}),e.jsx(p,{xs:24,lg:12,children:e.jsx(c.Item,{label:"Status",name:"status",children:e.jsx(O,{options:Object.entries(F).map(([d,r])=>({value:r,label:d}))})})}),e.jsx(p,{xs:24,lg:12,children:e.jsx(c.Item,{label:"Assigned User",name:"assignedUserId",children:e.jsx(E,{})})}),e.jsx(p,{xs:24,lg:12,children:e.jsx(c.Item,{label:"Device Categories",name:"deviceCategoryIds",children:e.jsx(K,{mode:"multiple"})})})]})}),l&&e.jsx("div",{className:"loading-container",children:e.jsx(H,{})})]})}),ye=N(async({params:o},{permissions:n})=>{const{id:t}=o;if(!t)return C(n,b.PermissionsDevicesCreate),null;C(n,b.PermissionsDevicesEdit);const a=await V(()=>R.deviceGetById({id:+t}));if(!a)throw y("/devices");return a});function Ie(){const o=I(),[n,t]=s.useState(!1),a=s.useRef(null),i=()=>{a.current&&a.current.handelUpsert()};return e.jsxs(q,{children:[e.jsx(G,{title:o?"Update device":"Create device",children:e.jsx(P,{type:"primary",icon:e.jsx(z,{width:16,height:16}),onClick:i,loading:n,children:"Save"})}),e.jsx($,{items:[{title:"Home",path:"/"},{title:"Devices Manager",path:"/devices"},{title:o?"Update device":"Create device"}]}),e.jsx(T,{children:e.jsx(Q,{ref:a,setLoading:t,record:o})})]})}export{Ie as Component,ye as loader};
