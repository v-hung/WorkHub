import{r,j as e,a as b,f as w,h as P,B as N}from"./index--uR3bosk.js";import{w as I}from"./loader-C4fNgBr5.js";import{u as R}from"./useDeviceCategoryAction-DZDDAx-T.js";import{S as F}from"./SelectAsyncScroll-CqaChjMP.js";import{d as E}from"./common.utils-DPZ9yX3U.js";import{u as A}from"./useDevices-BYAm9DVi.js";import{i as L}from"./validate.utils-ciPUpZAo.js";import{F as u,R as B,C as v}from"./index-BgZba38B.js";import{I as D}from"./index-0qdCREwA.js";import{S as U}from"./index-D5u-G5-S.js";import{m as k}from"./error.utils-BlwQgnKf.js";import{w as H}from"./auth.store-DCyo43Do.js";import{P as C}from"./Permission-BrgRu2qR.js";import{D as M,a as O,b as V}from"./DefaultContent-rY5y8PUg.js";import{D as q}from"./DefaultBreadcrumb-DHRDwWi8.js";import{e as S}from"./hasPermission-A1V7tTeH.js";import{F as T}from"./save-outline-BtesEFZG.js";import"./index-Cw5KyAVY.js";import"./index-f1v-kFPc.js";import"./EllipsisOutlined-BTocrDpt.js";import"./dropdown-Dl8K4053.js";import"./index-c0GfCdz7.js";import"./collapse-BbEVqHco.js";import"./Input-CZqVGBfN.js";import"./useVariants-BuS53gwb.js";import"./useIcons-BCjpvc7O.js";import"./DownOutlined-DmCfGseC.js";import"./useBreakpoint-CJq1a_UD.js";const G=i=>{const{className:n,value:t,...a}=i,{devicePaginated:s,loading:h,request:l,updateRequest:c,fetchDevices:x}=A(),[j,f]=r.useState([]);r.useEffect(()=>{L(t)||x(Array.isArray(t)?t:[t]).then(o=>{f(o.map(m=>({label:m.name,value:m.id})))})},[]),r.useEffect(()=>{f(o=>{const m=s.data.map(p=>({label:p.name,value:p.id}));return s.currentPage===1?m:Array.from(new Map([...o??[],...m].map(p=>[p.value,p])).values())})},[s.data]);const d=r.useCallback(E(o=>{c(m=>({...m,pageNumber:1,searchConditions:[{column:"name",operator:"Contains",values:[o]}]}))},300),[l]),y=r.useCallback(()=>{s.hasNextPage&&c(o=>({...o,pageNumber:o.pageNumber+1}))},[l,s.hasNextPage]),g=()=>{c(o=>({...o,pageNumber:1}))};return e.jsx(F,{value:t,className:n,options:j,loading:h,onSearch:d,scrollInfiniteCb:y,firstOpenDropdown:g,...a})},$=r.memo(G),z=r.forwardRef((i,n)=>{const{className:t,record:a,setLoading:s,...h}=i,l=b(),{loading:c,create:x,update:j,formDefault:f}=R();r.useEffect(()=>{s&&s(c)},[c,s]);const[d]=u.useForm(),[y]=r.useState(f(a));return r.useImperativeHandle(n,()=>({handelUpsert(){d.validateFields().then(async()=>{const g=d.getFieldsValue();a?await j(a.id,g,()=>l("/device-categories")):await x(g,()=>l("/device-categories"))})}})),e.jsxs("div",{...h,className:`form-container ${t}`,children:[e.jsx(u,{layout:"vertical",form:d,initialValues:y,validateTrigger:"onSubmit",style:{paddingRight:"0.75rem",paddingTop:"1rem",paddingLeft:"0.75rem"},children:e.jsxs(B,{wrap:!0,gutter:{sm:8,md:16},children:[e.jsx(v,{xs:24,lg:12,children:e.jsx(u.Item,{label:"DeviceCategory name",name:"name",rules:[{required:!0}],children:e.jsx(D,{placeholder:"name"})})}),e.jsx(v,{span:24}),e.jsx(v,{xs:24,lg:12,children:e.jsx(u.Item,{label:"Description",name:"description",children:e.jsx(D,{placeholder:"description"})})}),e.jsx(v,{xs:24,lg:12,children:e.jsx(u.Item,{label:"Devices",name:"deviceIds",children:e.jsx($,{mode:"multiple"})})})]})}),c&&e.jsx("div",{className:"loading-container",children:e.jsx(U,{})})]})}),ye=I(async({params:i},{permissions:n})=>{const{id:t}=i;if(!t)return S(n,C.PermissionsDevicesCreate),null;S(n,C.PermissionsDevicesEdit);const a=await H(()=>k.deviceCategoryGetById({id:+t}));if(!a)throw w("/device-categories");return a});function De(){const i=P(),[n,t]=r.useState(!1),a=r.useRef(null),s=()=>{a.current&&a.current.handelUpsert()};return e.jsxs(M,{children:[e.jsx(O,{title:i?"Update device category":"Create device category",children:e.jsx(N,{type:"primary",icon:e.jsx(T,{width:16,height:16}),onClick:s,loading:n,children:"Save"})}),e.jsx(q,{items:[{title:"Home",path:"/"},{title:"Device Categories Manager",path:"/device-categories"},{title:i?"Update device category":"Create device category"}]}),e.jsx(V,{children:e.jsx(z,{ref:a,setLoading:t,record:i})})]})}export{De as Component,ye as loader};
