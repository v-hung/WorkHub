import{r as l,j as e,a as b,f as F,h as S,B as V}from"./index--uR3bosk.js";import{w as D}from"./loader-C4fNgBr5.js";import{u as E}from"./useRoleAction-12DrVNwC.js";import{P as v}from"./Permission-BrgRu2qR.js";import{R as w,C as d,F as f}from"./index-BgZba38B.js";import{C as g}from"./index-tL5HCDFB.js";import{I as y}from"./index-0qdCREwA.js";import{S as I}from"./index-D5u-G5-S.js";import{e as L}from"./error.utils-BlwQgnKf.js";import{w as k}from"./auth.store-DCyo43Do.js";import{D as B,a as A,b as $}from"./DefaultContent-rY5y8PUg.js";import{D as G}from"./DefaultBreadcrumb-DHRDwWi8.js";import{e as R}from"./hasPermission-A1V7tTeH.js";import{F as M}from"./save-outline-BtesEFZG.js";import"./collapse-BbEVqHco.js";import"./useBreakpoint-CJq1a_UD.js";import"./index-f1v-kFPc.js";import"./Input-CZqVGBfN.js";import"./useVariants-BuS53gwb.js";import"./common.utils-DPZ9yX3U.js";import"./index-c0GfCdz7.js";import"./DownOutlined-DmCfGseC.js";import"./dropdown-Dl8K4053.js";import"./EllipsisOutlined-BTocrDpt.js";const N=()=>{const s={};return Object.values(v).forEach(o=>{if(o.startsWith("Permissions.")){const[,a,t]=o.split(".");s[a]||(s[a]=[]),s[a].includes(t)||s[a].push(t)}}),Object.keys(s).forEach(o=>{s[o].sort((a,t)=>a.localeCompare(t))}),s},P=(s,o)=>`Permissions.${s}.${o}`,U=s=>{const{form:o,...a}=s,t=l.useMemo(()=>N(),[]),[n,u]=l.useState([]),h=(r,m)=>{const i=[...n.filter(c=>!c.startsWith(`Permissions.${r}.`)),...m];u(i)},p=r=>t[r].every(m=>n.includes(P(r,m))),j=(r,m)=>{const i=t[r].map(x=>P(r,x)),c=m?Array.from(new Set([...n,...i])):n.filter(x=>!i.includes(x));u(c)};return l.useEffect(()=>{const r=o.getFieldValue("permissions")||[];u(r)},[o]),l.useEffect(()=>{o.setFieldsValue({permissions:n})},[n,o]),e.jsxs(w,{align:"top",...a,wrap:!0,gutter:[16,16],children:[e.jsxs(d,{span:24,style:{marginBottom:"-.5rem"},children:[e.jsx(f.Item,{name:"permissions",noStyle:!0}),e.jsx("label",{children:"Permissions"})]}),Object.entries(t).map(([r,m])=>e.jsxs(d,{xs:24,sm:12,md:8,lg:6,style:{paddingLeft:".5rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8,paddingLeft:".5rem"},children:e.jsx(g,{checked:p(r),onChange:i=>j(r,i.target.checked),children:r})}),e.jsx(g.Group,{value:n.filter(i=>i.startsWith(`Permissions.${r}.`)),onChange:i=>h(r,i),children:e.jsx(w,{style:{paddingLeft:"1rem"},children:m.map(i=>{const c=P(r,i);return e.jsx(d,{span:24,children:e.jsx(g,{value:c,children:i})},c)})})})]},r))]})},W=l.forwardRef((s,o)=>{const{className:a,record:t,setLoading:n,...u}=s,h=b(),{loading:p,create:j,update:r,formDefault:m}=E();l.useEffect(()=>{n&&n(p)},[p,n]);const[i]=f.useForm(),[c]=l.useState(m(t));return l.useImperativeHandle(o,()=>({handelUpsert(){i.validateFields().then(async()=>{const C={...i.getFieldsValue()};t?await r(t.id,C,()=>h("/roles")):await j(C,()=>h("/roles"))})}})),e.jsxs("div",{...u,className:`form-container ${a}`,children:[e.jsx(f,{layout:"vertical",form:i,initialValues:c,validateTrigger:"onSubmit",children:e.jsxs(w,{wrap:!0,gutter:{sm:8,md:16},children:[e.jsx(d,{xs:24,lg:12,children:e.jsx(f.Item,{label:"Role name",name:"name",rules:[{required:!0}],children:e.jsx(y,{placeholder:"name"})})}),e.jsx(d,{xs:24,children:e.jsx(f.Item,{label:"Description",name:"description",children:e.jsx(y,{placeholder:"description"})})}),e.jsx(d,{xs:24,children:e.jsx(U,{form:i})})]})}),p&&e.jsx("div",{className:"loading-container",children:e.jsx(I,{})})]})}),ue=D(async({params:s},{permissions:o})=>{const{id:a}=s;if(!a)return R(o,v.PermissionsRolesCreate),null;R(o,v.PermissionsRolesView);const t=await k(()=>L.roleGetById({id:a}));if(!t)throw F("/roles");return t});function pe(){const s=S(),[o,a]=l.useState(!1),t=l.useRef(null),n=()=>{t.current&&t.current.handelUpsert()};return e.jsxs(B,{children:[e.jsx(A,{title:s?"Update role":"Create role",children:e.jsx(V,{type:"primary",icon:e.jsx(M,{width:16,height:16}),onClick:n,loading:o,children:"Save"})}),e.jsx(G,{items:[{title:"Home",path:"/"},{title:"Roles Manager",path:"/roles"},{title:s?"Update role":"Create role"}]}),e.jsx($,{children:e.jsx(W,{ref:t,setLoading:a,record:s})})]})}export{pe as Component,ue as loader};
